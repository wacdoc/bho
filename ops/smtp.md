# आपन खुद के एसएमटीपी मेल भेजने वाला सर्वर बनाईं

## प्रस्तावना में कहल गइल बा

एसएमटीपी सीधे क्लाउड विक्रेता से सेवा खरीद सकेला, जइसे कि:

* [अमेजन एसईएस एसएमटीपी के बा](https://docs.aws.amazon.com/ses/latest/dg/send-email-smtp.html)
* [अली बादल ईमेल धक्का बा](https://www.alibabacloud.com/help/directmail/latest/three-mail-sending-methods)

रउआँ आपन मेल सर्वर भी बना सकत बानी - असीमित भेजल, कम समग्र लागत।

नीचे हमनी के स्टेप बाई स्टेप देखावत बानी जा कि कइसे आपन मेल सर्वर बनावल जा सकेला.

## सर्वर के चयन के बारे में बतावल गइल बा

सेल्फ होस्टेड एसएमटीपी सर्वर खातिर एगो पब्लिक आईपी के जरूरत होला जेह में पोर्ट 25, 456, आ 587 खुलल होखे।

आमतौर पर इस्तेमाल होखे वाला पब्लिक क्लाउड सभ एह पोर्ट सभ के डिफ़ॉल्ट रूप से ब्लॉक क दिहले बाड़ें, आ वर्क ऑर्डर जारी क के इनहन के खोलल संभव हो सके ला, बाकी ई आखिरकार बहुत परेशानी वाला बा।

हम अइसन होस्ट से खरीदे के सलाह देत बानी जवना में ई पोर्ट खुलल होखे आ रिवर्स डोमेन नाम सेटअप करे के सपोर्ट होखे.

इहाँ, हम [Contabo के](https://contabo.com) सलाह देत बानी।

कोन्टाबो जर्मनी के म्यूनिख में स्थित एगो होस्टिंग प्रदाता ह, जवना के स्थापना 2003 में भईल रहे अवुरी एकर दाम बहुत प्रतिस्पर्धी बा।

अगर आप खरीद के मुद्रा के रूप में यूरो चुनी त एकर कीमत सस्ता होई (8GB मेमोरी अवुरी 4 CPU वाला सर्वर के कीमत लगभग 529 युआन प्रति साल बा, अवुरी शुरुआती इंस्टॉलेशन शुल्क एक साल खाती मुफ्त बा)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/UoAQkwY.webp)

ऑर्डर देत घरी, टिप्पणी करीं `prefer AMD` , आ AMD CPU वाला सर्वर के बेहतर प्रदर्शन होखी।

निम्नलिखित में हम कोन्टाबो के वीपीएस के उदाहरण के रूप में लेके इ देखावत बानी कि आपन खुद के मेल सर्वर कइसे बनावल जाला।

## उबंटू सिस्टम के कॉन्फ़िगरेशन बा

इहाँ के ऑपरेटिंग सिस्टम उबंटू 22.04 बा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/smpIu1F.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/m7Mwjwr.webp)

अगर ssh पर सर्वर प्रदर्शित करेला त `Welcome to TinyCore 13!` (जइसे कि नीचे दिहल आकृति में देखावल गइल बा), एकर मतलब ई बा कि सिस्टम अबहिन ले इंस्टॉल नइखे भइल। कृपया ssh के डिस्कनेक्ट करीं आ कुछ मिनट इंतजार करीं आ फेर से लॉग इन करीं.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/-qKACz9.webp)

जब `Welcome to Ubuntu 22.04.1 LTS` लउकी त इनिशियलाइजेशन पूरा हो जाला, आ रउआ निम्नलिखित चरण के जारी रख सकेनी।

### [वैकल्पिक] विकास के माहौल के शुरुआत करीं

ई कदम वैकल्पिक बा।

सुविधा खातिर हम उबंटू सॉफ्टवेयर के इंस्टॉलेशन आ सिस्टम कॉन्फ़िगरेशन [github.com/wactax/ops.os/tree/main/ubuntu](https://github.com/wactax/ops.os/tree/main/ubuntu) में रखले बानी।

एक क्लिक से इंस्टॉल करे खातिर निम्नलिखित कमांड चलाईं।

```
bash <(curl -s https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

चीनी प्रयोगकर्ता लोग, कृपया एकरे बजाय निम्नलिखित कमांड के इस्तेमाल करीं, आ भाषा, समय क्षेत्र इत्यादि स्वचालित रूप से सेट हो जाई।

```
CN=1 bash <(curl -s https://ghproxy.com/https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

### कोन्टाबो आईपीवी6 के सक्षम करेला

IPV6 सक्षम करीं ताकि SMTP IPV6 पता वाला ईमेल भी भेज सके।

`/etc/sysctl.conf` के संपादन करीं

निम्नलिखित लाइनन के संशोधित करीं भा जोड़ दीं

```
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
```

[contabo ट्यूटोरियल के साथ फॉलोअप करीं: अपना सर्वर में IPv6 कनेक्टिविटी जोड़ल](https://contabo.com/blog/adding-ipv6-connectivity-to-your-server/)

`/etc/netplan/01-netcfg.yaml` संपादित करीं, कुछ लाइन जोड़ीं जइसे कि नीचे दिहल आकृति में देखावल गइल बा (Contabo VPS डिफ़ॉल्ट कॉन्फ़िगरेशन फाइल में ई लाइन पहिले से बा, बस एकरा के अनकमेंट करीं)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/5MEi41I.webp)

एकरा बाद संशोधित कॉन्फ़िगरेशन के प्रभावी बनावे खातिर `netplan apply` ।

कॉन्फ़िगरेशन सफल होखला के बाद, आप अपना बाहरी नेटवर्क के ipv6 पता देखे खातिर `curl 6.ipw.cn` इस्तेमाल क सकतानी।

## कॉन्फ़िगरेशन रिपोजिटरी ऑप्स के क्लोन करीं

```
git clone https://github.com/wactax/ops.soft.git
```

## अपना डोमेन नाम खातिर एगो मुफ्त SSL प्रमाणपत्र जनरेट करीं

मेल भेजे खातिर एन्क्रिप्शन आ साइनिंग खातिर SSL प्रमाणपत्र के जरूरत होला।

हमनी के प्रमाणपत्र पैदा करे खातिर [acme.sh के](https://github.com/acmesh-official/acme.sh) इस्तेमाल करेनी जा।

acme.sh एगो ओपन सोर्स स्वचालित प्रमाणपत्र साइनिंग टूल हवे,

कॉन्फ़िगरेशन वेयरहाउस ops.soft दर्ज करीं, `./ssl.sh` चलाईं, आ **ऊपरी डाइरेक्टरी** में एगो `conf` फोल्डर बनावल जाई।

[acme.sh dnsapi](https://github.com/acmesh-official/acme.sh/wiki/dnsapi) से आपन DNS प्रदाता खोजीं, `conf/conf.sh` के संपादित करीं।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Qjq1C1i.webp)

एकरा बाद `./ssl.sh 123.com` चला के अपना डोमेन नाम खातिर `123.com` आ `*.123.com` प्रमाणपत्र पैदा करीं.

पहिला रन में [acme.sh](https://github.com/acmesh-official/acme.sh) स्वचालित रूप से इंस्टॉल हो जाई अवुरी स्वचालित नवीकरण खाती एगो निर्धारित काम जोड़ल जाई। रउआँ `crontab -l` देख सकत बानी, अइसन लाइन बा जवन निम्नलिखित बा।

```
52 0 * * * "/mnt/www/.acme.sh"/acme.sh --cron --home "/mnt/www/.acme.sh" > /dev/null
```

जनरेट कइल प्रमाणपत्र खातिर रास्ता कुछ अइसन बा जइसे कि `/mnt/www/.acme.sh/123.com_ecc。`

प्रमाणपत्र के नवीकरण `conf/reload/123.com.sh` स्क्रिप्ट के कॉल करी, एह स्क्रिप्ट के संपादित करीं, रउआ संबंधित एप्लीकेशन के प्रमाणपत्र कैश के ताजा करे खातिर `nginx -s reload` जइसन कमांड जोड़ सकेनी।

## चस्किड के साथ एसएमटीपी सर्वर बनाईं

[chasquid](https://github.com/albertito/chasquid) एगो ओपन सोर्स एसएमटीपी सर्वर हवे जे गो भाषा में लिखल गइल बा।

पोस्टफिक्स आ सेंडमेल नियर प्राचीन मेल सर्वर प्रोग्राम सभ के विकल्प के रूप में, चस्किड के इस्तेमाल सरल आ आसान होला, आ ई सेकेंडरी डेवलपमेंट खातिर भी आसान होला।

रन `./chasquid/init.sh 123.com` एक क्लिक से स्वचालित रूप से इंस्टॉल हो जाई (123.com के बदल के आपन भेजत डोमेन नाम डाल दीं)।

## ईमेल हस्ताक्षर डीकेआईएम के कॉन्फ़िगर करीं

डीकेआईएम के इस्तेमाल ईमेल हस्ताक्षर भेजे खातिर कइल जाला जेहसे कि चिट्ठी के स्पैम ना मानल जा सके.

कमांड के सफलतापूर्वक चलला के बाद, रउआँ से DKIM रिकार्ड सेट करे के कहल जाई (जइसे कि नीचे देखावल गइल बा)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/LJWGsmI.webp)

बस अपना डीएनएस में एगो TXT रिकार्ड जोड़ीं (जइसे कि नीचे देखावल गइल बा)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/0szKWqV.webp)

## सेवा के स्थिति & लॉग देखल जाव

 `systemctl status chasquid` सेवा के स्थिति देखल जाव।

सामान्य संचालन के स्थिति नीचे दिहल आकृति में देखावल गइल बा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/CAwyY4E.webp)

 `grep chasquid /var/log/syslog` या `journalctl -xeu chasquid` त्रुटि लॉग देख सके ला।

## डोमेन नाम के कॉन्फ़िगरेशन के उलट दिहल जाला

रिवर्स डोमेन नाँव एह खातिर होला कि आईपी पता के संबंधित डोमेन नाँव पर रिजोल्यूशन कइल जा सके।

रिवर्स डोमेन नाम सेट कइला से ईमेल के स्पैम के रूप में पहचानल ना जा सके.

जब मेल मिल जाई तब रिसीविंग सर्वर भेजत सर्वर के आईपी पता पर रिवर्स डोमेन नेम एनालिसिस करी आ ई पुष्टि करी कि भेजत सर्वर के वैध रिवर्स डोमेन नाम बा कि ना.

अगर भेजत सर्वर के रिवर्स डोमेन नाँव ना होखे भा रिवर्स डोमेन नाँव भेजत सर्वर के आईपी पता से मेल ना खात होखे तब रिसीविंग सर्वर ईमेल के स्पैम के रूप में पहिचान सके ला या रिजेक्ट क सके ला।

[https://my.contabo.com/rdns](https://my.contabo.com/rdns) पर जाईं आ नीचे देखावल तरीका से कॉन्फ़िगर करीं

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/IIPdBk_.webp)

रिवर्स डोमेन नाम सेट कइला के बाद याद राखीं कि डोमेन नाम ipv4 आ ipv6 के फॉरवर्ड रिजोल्यूशन के सर्वर पर कॉन्फ़िगर करीं.

## chasquid.conf के होस्टनाम के संपादित करीं

`conf/chasquid/chasquid.conf` रिवर्स डोमेन नाँव के मान में संशोधित करीं।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/6Fw4SQi.webp)

एकरा बाद सेवा के रिस्टार्ट करे खातिर `systemctl restart chasquid` चलाईं।

## बैकअप conf से git रिपोजिटरी के बा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Fier9uv.webp)

उदाहरण खातिर, हम conf फोल्डर के बैकअप अपना github प्रक्रिया में निम्नलिखित तरीका से लेत बानी

पहिले एगो निजी गोदाम बनाईं

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ZSCT1t1.webp)

conf डाइरेक्टरी दर्ज करीं आ गोदाम में जमा करीं

```
git init
git add .
git commit -m "init"
git branch -M main
git remote add origin git@github.com:wac-tax-key/conf.git
git push -u origin main
```

## प्रेषक के जोड़ल जाव

दउरीं

```
chasquid-util user-add i@wac.tax
```

प्रेषक के जोड़ सकेला

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/khHjLof.webp)

### सत्यापन करीं कि पासवर्ड सही सेट बा कि ना

```
chasquid-util authenticate i@wac.tax --password=xxxxxxx
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/e92JHXq.webp)

उपयोगकर्ता के जोड़ला के बाद `chasquid/domains/wac.tax/users` अपडेट हो जाई, याद राखीं कि ओकरा के गोदाम में जमा करीं।

## डीएनएस एसपीएफ रिकार्ड जोड़ देला

एसपीएफ ( Sender Policy Framework ) एगो ईमेल सत्यापन तकनीक हवे जेकर इस्तेमाल ईमेल धोखाधड़ी के रोके खातिर कइल जाला।

ई कवनो मेल भेजे वाला के पहचान के सत्यापन एह बात के जाँच करेला कि प्रेषक के आईपी पता ओह डोमेन नाम के डीएनएस रिकार्ड से मेल खाला जवना के ऊ दावा करेला जवना से जालसाज बोगस ईमेल ना भेज पावेलें.

एसपीएफ रिकार्ड जोड़ला से ईमेल के स्पैम के रूप में अधिका से अधिका पहचान ना हो सके.

अगर राउर डोमेन नेम सर्वर एसपीएफ टाइप के सपोर्ट नइखे करत त बस TXT टाइप रिकार्ड जोड़ीं.

जइसे कि `wac.tax` के एसपीएफ निम्नलिखित बा

`v=spf1 a mx include:_spf.wac.tax include:_spf.google.com ~all`

`_spf.wac.tax` खातिर एसपीएफ बा

`v=spf1 a:smtp.wac.tax ~all`

ध्यान रहे कि हम इहाँ `include:_spf.google.com` रखले बानी, एकर कारण बा कि हम बाद में गूगल मेलबॉक्स में भेजल पता के रूप में `i@wac.tax` कॉन्फ़िगर करब।

## डीएनएस कॉन्फ़िगरेशन डीएमएआरसी के बा

DMARC (डोमेन आधारित संदेश प्रमाणीकरण, रिपोर्टिंग आ अनुरूपता) के संक्षिप्त रूप हवे।

एकर इस्तेमाल एसपीएफ बाउंस के कैप्चर करे खातिर होला (शायद कॉन्फ़िगरेशन त्रुटि के कारण, या केहू अउरी स्पैम भेजे खातिर रउआँ के नाटक करत बा)।

TXT रिकार्ड `_dmarc` जोड़ल जाला , .

सामग्री निम्नलिखित बा

```
v=DMARC1; p=quarantine; fo=1; ruf=mailto:ruf@wac.tax; rua=mailto:rua@wac.tax
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/k44P7O3.webp)

हर पैरामीटर के मतलब निम्नलिखित बा

### पी (नीति) के बा।

ई बतावे ला कि अइसन ईमेल सभ के कइसे संभालल जाय जे SPF (प्रेषक नीति ढाँचा) भा DKIM (DomainKeys Identified Mail) सत्यापन में फेल हो जालें। p पैरामीटर के तीन गो मान में से कौनों एक पर सेट कइल जा सके ला:

* none: कवनो कार्रवाई ना कइल जाला, खाली सत्यापन परिणाम के ईमेल रिपोर्टिंग तंत्र के माध्यम से प्रेषक के वापस फीड कइल जाला।
* क्वारंटाइन : जवन मेल सत्यापन पास नइखे भइल ओकरा के स्पैम फोल्डर में डाल दीं, बाकिर सीधे मेल के अस्वीकार ना करी.
* reject: सत्यापन में असफल होखे वाला ईमेल के सीधे अस्वीकार करीं।

### fo (विफलता के विकल्प) के बा।

रिपोर्टिंग तंत्र द्वारा वापस कइल गइल जानकारी के मात्रा निर्दिष्ट करे ला। एकरा के निम्नलिखित मान सभ में से कौनों एक पर सेट कइल जा सके ला:

* 0: सभ संदेश खातिर सत्यापन परिणाम के रिपोर्ट करीं
* 1: खाली ओह संदेशन के रिपोर्ट करीं जवन सत्यापन में असफल हो जाव
* d: खाली डोमेन नाम सत्यापन विफलता के रिपोर्ट करीं
* s: खाली एसपीएफ सत्यापन विफलता के रिपोर्ट करीं
* एल: खाली डीकेआईएम सत्यापन विफलता के रिपोर्ट करीं

### rua & ruf के बा

* rua (एग्रेट रिपोर्ट खातिर यूआरआई रिपोर्टिंग): एकट्ठा रिपोर्ट प्राप्त करे खातिर ईमेल पता
* ruf (फोरेंसिक रिपोर्ट खातिर यूआरआई के रिपोर्टिंग): विस्तृत रिपोर्ट पावे खातिर ईमेल पता

## गूगल मेल पर ईमेल आगे भेजे खातिर एमएक्स रिकार्ड जोड़ीं

चुकी हमरा कवनो मुफ्त कॉर्पोरेट मेलबॉक्स ना मिलल जवन यूनिवर्सल एड्रेस के सपोर्ट करे (कैच-ऑल, एह डोमेन नाम पर भेजल कवनो ईमेल रिसीव कर सकेला, बिना उपसर्ग पर कवनो रोक के), एहसे हम सगरी ईमेल के अपना जीमेल मेलबॉक्स में फॉरवर्ड करे खातिर चास्किड के इस्तेमाल कइनी.

**अगर रउरा लगे आपन पेड बिजनेस मेलबॉक्स बा त कृपया एमएक्स में संशोधन मत करीं आ एह कदम के छोड़ दीं.**

`conf/chasquid/domains/wac.tax/aliases` संपादित करीं, मेलबॉक्स के आगे बढ़ावे के सेट करीं

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/OBDl2gw.webp)

`*` सभ ईमेल के इंगित करेला, `i` ऊपर बनावल भेजत उपयोगकर्ता के ईमेल पता उपसर्ग ह। मेल के आगे बढ़ावे खातिर हर प्रयोगकर्ता के एगो लाइन जोड़ल जरूरी होला।

एकरा बाद एमएक्स रिकॉर्ड जोड़ीं (हम इहाँ सीधा रिवर्स डोमेन नाम के पता के ओर इशारा करतानी, जईसे कि नीचे दिहल आकृति में पहिला लाइन में देखावल गईल बा)।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/7__KrU8.webp)

कॉन्फ़िगरेशन पूरा होखला के बाद आप `i@wac.tax` अवुरी `any123@wac.tax` प ईमेल भेजे खाती अवुरी ईमेल पता के इस्तेमाल क के देख सकतानी कि जीमेल में ईमेल मिल सकता कि ना।

अगर ना, त चस्किड लॉग ( `grep chasquid /var/log/syslog` ) के जांच करीं।

## गूगल मेल से i@wac.tax पर ईमेल भेजीं

गूगल मेल के मेल मिलला के बाद स्वाभाविक रूप से हमरा उम्मीद रहे कि हम i.wac.tax@gmail.com के जगह `i@wac.tax` से जवाब देब।

[https://mail.google.com/mail/u/1/#settings/accounts](https://mail.google.com/mail/u/1/#settings/accounts) पर जाईं आ "अउरी ईमेल पता जोड़ीं" पर क्लिक करीं.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/PAvyE3C.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/_OgLsPT.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/XIUf6Dc.webp)

एकरा बाद, जवना ईमेल के आगे भेजल गईल रहे ओकरा के मिलल सत्यापन कोड दर्ज करीं।

अंत में एकरा के डिफ़ॉल्ट प्रेषक पता (एही पता से जवाब देवे के विकल्प के संगे) के रूप में सेट कईल जा सकता।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/a95dO60.webp)

एह तरह से हमनी का एसएमटीपी मेल सर्वर के स्थापना पूरा कर लिहले बानी जा आ साथे साथ ईमेल भेजे आ पावे खातिर गूगल मेल के इस्तेमाल कर लिहले बानी जा.

## एगो परीक्षण ईमेल भेजीं कि कॉन्फ़िगरेशन सफल बा कि ना

`ops/chasquid` दर्ज करीं

`direnv allow` (direnv के पिछला एक-की इनिशियलाइजेशन प्रक्रिया में इंस्टॉल कइल गइल बा आ शेल में एगो हुक जोड़ल गइल बा)

फेर दौड़ल जाव

```
user=i@wac.tax pass=xxxx to=iuser.link@gmail.com ./sendmail.coffee
```

पैरामीटर के मतलब निम्नलिखित बा

* उपयोगकर्ता: एसएमटीपी उपयोगकर्ता नाम बा
* पास: एसएमटीपी पासवर्ड के बा
* के: प्राप्तकर्ता के बा

रउरा एगो परीक्षण ईमेल भेज सकेनी.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ae1iWyM.webp)

परीक्षण ईमेल प्राप्त करे खातिर जीमेल के इस्तेमाल करे के सलाह दिहल जाला ताकि ई जाँच हो सके कि कॉन्फ़िगरेशन सफल बा कि ना।

### टीएलएस मानक एन्क्रिप्शन के बा

जइसे कि नीचे दिहल आकृति में देखावल गइल बा, ई छोट लॉक बा, मतलब कि SSL प्रमाणपत्र सफलतापूर्वक सक्षम हो गइल बा।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/SrdbAwh.webp)

ओकरा बाद "मूल ईमेल देखाईं" पर क्लिक करीं.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/qQQsdxg.webp)

### डीकेआईएम के बा

जइसे कि नीचे दिहल आकृति में देखावल गइल बा, जीमेल के मूल मेल पन्ना पर DKIM देखावल जाला, मतलब कि DKIM कॉन्फ़िगरेशन सफल बा।

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/an6aXK6.webp)

मूल ईमेल के हेडर में Received के जांच करीं, त रउआ देख सकेनी कि प्रेषक के पता IPV6 बा, मतलब कि IPV6 भी सफलतापूर्वक कॉन्फ़िगर हो गईल बा।
